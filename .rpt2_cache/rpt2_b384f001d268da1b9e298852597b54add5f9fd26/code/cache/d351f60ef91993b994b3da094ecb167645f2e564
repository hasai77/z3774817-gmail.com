{
  "code": "import { ui } from \"./../ui/layaMaxUI\";\r\nvar Handler = Laya.Handler;\r\nvar Tween = Laya.Tween;\r\nvar Event = Laya.Event;\r\nexport default class playScene extends ui.playSceneUI {\r\n    constructor() {\r\n        super();\r\n        this.cardUnknow = new Array();\r\n        this.leftHand = new Array();\r\n        this.rightHand = new Array();\r\n        this.upHand = new Array();\r\n        this.downHand = new Array();\r\n        this.pengDown = new Array();\r\n        this.pengLeft = new Array();\r\n        this.pengRight = new Array();\r\n        this.pengUp = new Array();\r\n        this.leftShowed = new Array();\r\n        this.rightShowed = new Array();\r\n        this.downShowed = new Array();\r\n        this.upShowed = new Array();\r\n        this.dealTimes = 0;\r\n        this.point = new Laya.Vector2();\r\n    }\r\n    onAwake() {\r\n        this.cardMeshName = [\"res/LayaScene_playScene/Conventional/Assets/majiang/Materials/mj_dif.lmat\"];\r\n        for (let i = 1; i < 42; i++) {\r\n            this.cardMeshName.push(`res/LayaScene_playScene/Conventional/Assets/majiang/Materials/mj_dif ${i}.lmat`);\r\n        }\r\n        Laya.loader.create([\"res/LayaScene_playScene/Conventional/playScene.ls\", ...this.cardMeshName], Laya.Handler.create(this, this.onCreated), Laya.Handler.create(this, (e) => {\r\n        }));\r\n        this.fapai.clickHandler = new Handler(this, this.onClickButton, [this.fapai]);\r\n        this.mopai.clickHandler = new Handler(this, this.onClickMopai, [this.mopai]);\r\n        this.dapai.clickHandler = new Handler(this, this.onClickDapai, [this.dapai]);\r\n        this._ray = new Laya.Ray(new Laya.Vector3(0, 0, 0), new Laya.Vector3(0, 0, 0));\r\n        this.point = new Laya.Vector2();\r\n        this._outHitResult = new Laya.HitResult();\r\n    }\r\n    onClickDapai(button) {\r\n        let card5 = this.downHand[5];\r\n        card5.active = false;\r\n        let card13 = this.downHand[13];\r\n        Tween.to(card13.transform, { localPositionZ: card13.transform.localPositionZ - 0.05, localRotationEulerY: 30 }, 300, null, Handler.create(this, () => {\r\n            Tween.to(card13.transform, { localPositionX: card5.transform.localPositionX, localRotationEulerY: 0 }, 500, null, Handler.create(this, () => {\r\n                Tween.to(card13.transform, { localPositionZ: 0 }, 300);\r\n            }));\r\n        }));\r\n    }\r\n    onClickMopai(button) {\r\n        console.log(\"摸牌哦\");\r\n        let targetCard = this.downHand[13];\r\n        if (!targetCard.active) {\r\n            let card = this.cardUnknow.shift();\r\n            card.active = false;\r\n            targetCard.active = true;\r\n        }\r\n    }\r\n    onClickButton(button) {\r\n        console.log(\"发牌哦\");\r\n        this.handArr = [this.downHand, this.leftHand, this.upHand, this.rightHand];\r\n        Laya.timer.loop(100, this, this.dealCards);\r\n    }\r\n    dealCards() {\r\n        let curHand = this.handArr[this.dealTimes % 4];\r\n        let integer = Math.floor(this.dealTimes / 4);\r\n        if (integer <= 2) {\r\n            for (let i = integer * 4; i < (integer + 1) * 4; i++) {\r\n                curHand[i].active = true;\r\n            }\r\n            for (let i = 0; i < 4; i++) {\r\n                let card = this.cardUnknow.shift();\r\n                card.active = false;\r\n            }\r\n        }\r\n        else {\r\n            curHand[integer * 4].active = true;\r\n            let card = this.cardUnknow.shift();\r\n            card.active = false;\r\n        }\r\n        if (++this.dealTimes >= 16) {\r\n            Laya.timer.clear(this, this.dealCards);\r\n        }\r\n    }\r\n    init(scene) {\r\n        this._camera = scene.getChildByName(\"Main Camera\");\r\n        this._scene = scene;\r\n        scene.getChildByName(\"骰子\").active = false;\r\n        let pengDown = scene.getChildByName(\"pengDown\");\r\n        let pengLeft = scene.getChildByName(\"pengLeft\");\r\n        let pengRight = scene.getChildByName(\"pengRight\");\r\n        let pengUp = scene.getChildByName(\"pengUp\");\r\n        for (let i = 0; i < pengDown.numChildren; i++) {\r\n            pengDown.getChildAt(i).active = false;\r\n            this.pengDown.push(pengDown.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < pengLeft.numChildren; i++) {\r\n            pengLeft.getChildAt(i).active = false;\r\n            this.pengLeft.push(pengLeft.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < pengUp.numChildren; i++) {\r\n            pengUp.getChildAt(i).active = false;\r\n            this.pengUp.push(pengUp.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < pengRight.numChildren; i++) {\r\n            pengRight.getChildAt(i).active = false;\r\n            this.pengRight.push(pengRight.getChildAt(i));\r\n        }\r\n        let leftShowed = scene.getChildByName(\"leftShowed\");\r\n        let rightShowed = scene.getChildByName(\"rightShowed\");\r\n        let downShowed = scene.getChildByName(\"downShowed\");\r\n        let upShowed = scene.getChildByName(\"upShowed\");\r\n        for (let i = 0; i < leftShowed.numChildren; i++) {\r\n            leftShowed.getChildAt(i).active = false;\r\n            this.leftShowed.push(leftShowed.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < rightShowed.numChildren; i++) {\r\n            rightShowed.getChildAt(i).active = false;\r\n            this.rightShowed.push(rightShowed.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < downShowed.numChildren; i++) {\r\n            downShowed.getChildAt(i).active = false;\r\n            this.downShowed.push(downShowed.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < upShowed.numChildren; i++) {\r\n            upShowed.getChildAt(i).active = false;\r\n            this.upShowed.push(upShowed.getChildAt(i));\r\n        }\r\n        let leftHand = scene.getChildByName(\"leftHand\");\r\n        let rightHand = scene.getChildByName(\"rightHand\");\r\n        let downHand = scene.getChildByName(\"downHand\");\r\n        let upHand = scene.getChildByName(\"upHand\");\r\n        for (let i = 0; i < leftHand.numChildren; i++) {\r\n            leftHand.getChildAt(i).active = false;\r\n            this.leftHand.push(leftHand.getChildAt(i));\r\n        }\r\n        for (let i = 0; i < rightHand.numChildren; i++) {\r\n            rightHand.getChildAt(i).active = false;\r\n            this.rightHand.push(rightHand.getChildAt(i));\r\n        }\r\n        let leng = downHand.numChildren;\r\n        for (let i = 0; i < leng; i++) {\r\n            downHand.getChildAt(i).active = false;\r\n            this.downHand.push((scene.getChildByName(\"麻将高001\").getChildByName(\"default183\").clone()));\r\n            this.downHand[i].active = false;\r\n            this.downHand[i][\"clicked\"] = false;\r\n            this.downHand[i][\"index\"] = i;\r\n            downHand.addChild(this.downHand[i]);\r\n            this.downHand[i].transform.localPositionX = downHand.getChildAt(i).transform.localPositionX;\r\n            this.downHand[i].transform.localPositionY = downHand.getChildAt(i).transform.localPositionY;\r\n            this.downHand[i].transform.localPositionZ = downHand.getChildAt(i).transform.localPositionZ;\r\n        }\r\n        for (let i = 0; i < upHand.numChildren; i++) {\r\n            upHand.getChildAt(i).active = false;\r\n            this.upHand.push(upHand.getChildAt(i));\r\n        }\r\n        let up = scene.getChildByName(\"up\");\r\n        let left = scene.getChildByName(\"left\");\r\n        let down = scene.getChildByName(\"down\");\r\n        let right = scene.getChildByName(\"right\");\r\n        for (let i = 0; i < down.numChildren / 2; i++) {\r\n            this.cardUnknow.push(down.getChildAt(i));\r\n            this.cardUnknow.push(down.getChildAt(i + down.numChildren / 2));\r\n        }\r\n        for (let i = 0; i < left.numChildren / 2; i++) {\r\n            this.cardUnknow.push(left.getChildAt(i));\r\n            this.cardUnknow.push(left.getChildAt(i + left.numChildren / 2));\r\n        }\r\n        for (let i = 0; i < up.numChildren / 2; i++) {\r\n            this.cardUnknow.push(up.getChildAt(i));\r\n            this.cardUnknow.push(up.getChildAt(i + up.numChildren / 2));\r\n        }\r\n        for (let i = 0; i < right.numChildren / 2; i++) {\r\n            this.cardUnknow.push(right.getChildAt(i));\r\n            this.cardUnknow.push(right.getChildAt(i + right.numChildren / 2));\r\n        }\r\n    }\r\n    onCreated() {\r\n        let scene = Laya.stage.addChild(Laya.Loader.getRes(\"res/LayaScene_playScene/Conventional/playScene.ls\"));\r\n        scene.zOrder = -1;\r\n        Laya.stage.on(Event.MOUSE_UP, this, this.sceneClick);\r\n        this.init(scene);\r\n    }\r\n    sceneClick(e) {\r\n        this.point.x = Laya.MouseManager.instance.mouseX;\r\n        this.point.y = Laya.MouseManager.instance.mouseY;\r\n        console.log(this.point);\r\n        this._camera.viewportPointToRay(this.point, this._ray);\r\n        console.log(this._ray);\r\n        this._scene.physicsSimulation.rayCast(this._ray, this._outHitResult);\r\n        if (this._outHitResult.succeeded) {\r\n            let index = this._outHitResult.collider.owner[\"index\"];\r\n            let clicked = this._outHitResult.collider.owner[\"clicked\"];\r\n            Tween.to(this.downHand[index].transform, { localPositionZ: clicked ? -0.00 : -0.015 }, 200, null, Handler.create(this, () => { }));\r\n            this.downHand.forEach(element => {\r\n                if (element[\"index\"] != index && element[\"clicked\"]) {\r\n                    Tween.to(element.transform, { localPositionZ: 0 }, 200, null, Handler.create(this, () => { }));\r\n                    element[\"clicked\"] = false;\r\n                }\r\n            });\r\n            this._outHitResult.collider.owner[\"clicked\"] = !clicked;\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "C:/Users/Administrator/Documents/majiang/src/ui/layaMaxUI.ts"
  ]
}
